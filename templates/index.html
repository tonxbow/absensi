<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Device Network Settings</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f6f8;
        margin: 0;
        padding: 20px;
    }
    h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 20px;
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
    }
    .card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        transition: 0.3s;
    }
    .card:hover {
        box-shadow: 0 6px 15px rgba(0,0,0,0.08);
    }
    label {
        display: block;
        margin-top: 12px;
        font-weight: 500;
        color: #34495e;
    }
    input, select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
    }
    button {
        margin-top: 15px;
        padding: 10px 16px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
    }
    button:hover {
        background: #2980b9;
    }
    .info p {
        margin: 4px 0;
        color: #555;
    }

    /* Flash message */
    .flash {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid;
        opacity: 1;
        transition: opacity 0.5s;
        font-weight: 500;
    }
    .flash.success {
        background: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }
    .flash.error {
        background: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }
</style>
<script>
function showForm() {
    var selected = document.getElementById('formSelect').value;
    document.getElementById('ethernetForm').style.display = (selected == 'ethernet') ? 'block' : 'none';
    document.getElementById('wifiForm').style.display = (selected == 'wifi') ? 'block' : 'none';
    document.getElementById('deviceForm').style.display = (selected == 'device') ? 'block' : 'none';
}

// Auto-hide flash message setelah 5 detik
window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.flash').forEach(flashMsg => {
        setTimeout(() => {
            flashMsg.style.opacity = "0";
            setTimeout(() => flashMsg.remove(), 500);
        }, 5000);
    });
});
</script>
</head>
<body>

<div class="container">
<h1>Device Network Settings</h1>

<!-- Flash message -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="flash {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Informasi Device -->
<div class="card info">
    <p><b>Current Ethernet IP:</b> {{ eth_ip }}</p>
    <p><b>Current WiFi IP:</b> {{ wlan_ip }}</p>
    <p><b>Machine ID:</b> {{ cfg.get('machine-id', '-') }}</p>
    <p><b>API Server:</b> {{ cfg.get('api-server', '-') }}</p>
</div>

<!-- Pilih Form -->
<div class="card">
    <label>Pilih Form Setting:</label>
    <select id="formSelect" onchange="showForm()">
        <option value="">-- Pilih --</option>
        <option value="ethernet">Ethernet</option>
        <option value="wifi">WiFi</option>
        <option value="device">Device</option>
    </select>
</div>

<form method="POST" action="/save_all">
    <!-- ETHERNET FORM -->
    <div class="card" id="ethernetForm" style="display:none;">
        <h2>Ethernet Settings</h2>
        <label>IP Address:</label>
        <input type="text" name="ip" value="{{ cfg.get('ethernet', {}).get('ip', '') }}">
        <label>Subnet Mask:</label>
        <input type="text" name="subnet" value="{{ cfg.get('ethernet', {}).get('subnet', '') }}">
        <label>Gateway:</label>
        <input type="text" name="gateway" value="{{ cfg.get('ethernet', {}).get('gateway', '') }}">
    </div>

    <!-- WIFI FORM -->
    <div class="card" id="wifiForm" style="display:none;">
        <h2>WiFi Settings</h2>
        <label>SSID:</label>
        <input type="text" name="ssid" value="{{ cfg.get('wifi', {}).get('ssid', '') }}">
        <label>Password:</label>
        <input type="password" name="password" value="{{ cfg.get('wifi', {}).get('password', '') }}">
    </div>

    <!-- DEVICE FORM -->
    <div class="card" id="deviceForm" style="display:none;">
        <h2>Device Settings</h2>
        <label>Machine ID:</label>
        <input type="text" name="machine_id" value="{{ cfg.get('machine-id', '') }}">
        <label>API Address:</label>
        <input type="text" name="api_host" value="{{ cfg.get('api-server', '') }}">
    </div>

    <div style="text-align:center;">
        <button type="submit">Save All Settings</button>
    </div>
</form>

</div>
</body>
</html>
