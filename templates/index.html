<!DOCTYPE html>
<html>
<head>
    <title>Network Config</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 0; }
        .container { width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
        h2 { background: #007BFF; color: white; padding: 10px; border-radius: 5px; }
        form { margin-bottom: 20px; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; }
        button { background: #007BFF; color: white; border: none; padding: 10px; margin-top: 10px; cursor: pointer; }
        .status { padding: 10px; background: #eee; margin-bottom: 20px; border-radius: 5px; }
        .flash { background: #d4edda; padding: 10px; margin-bottom: 10px; border: 1px solid #c3e6cb; border-radius: 5px; }
    </style>
</head>
<body>
<div class="container">
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for msg in messages %}
            <div class="flash">{{ msg }}</div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="status">
        <b>Ethernet IP:</b> {{ eth_ip or '—' }} |
        <b>WiFi IP:</b> {{ wlan_ip or '—' }}
    </div>

    <h2>Ethernet</h2>
    <form method="post" action="{{ url_for('save_ethernet') }}">
        <label>Mode:</label>
        <select name="ethernet_mode">
            <option value="dhcp" {% if ethernet_cfg and ethernet_cfg.mode == 'dhcp' %}selected{% endif %}>DHCP</option>
            <option value="manual" {% if ethernet_cfg and ethernet_cfg.mode == 'manual' %}selected{% endif %}>Static</option>
        </select>
        <label>IP Address:</label>
        <input type="text" name="ip" value="{{ ethernet_cfg.ip if ethernet_cfg and ethernet_cfg.mode == 'manual' else '' }}">
        <label>Subnet Mask:</label>
        <input type="text" name="subnet" value="{{ ethernet_cfg.subnet if ethernet_cfg and ethernet_cfg.mode == 'manual' else '' }}">
        <label>Gateway:</label>
        <input type="text" name="gateway" value="{{ ethernet_cfg.gateway if ethernet_cfg and ethernet_cfg.mode == 'manual' else '' }}">
        <button type="submit">Save Ethernet</button>
    </form>

    <h2>WiFi</h2>
    <form method="post" action="{{ url_for('save_wifi') }}">
        <label>SSID:</label>
        <select name="ssid" id="ssid-list">
            {% if wifi_cfg %}
                <option value="{{ wifi_cfg.ssid }}">{{ wifi_cfg.ssid }}</option>
            {% endif %}
        </select>
        <button type="button" onclick="refreshSSID()">Refresh SSID</button>
        <label>Password:</label>
        <input type="password" name="password" value="{{ wifi_cfg.password if wifi_cfg else '' }}">
        <button type="submit">Save WiFi</button>
    </form>

    <h2>Device Info</h2>
    <form method="post" action="{{ url_for('save_device') }}">
        <label>Machine ID:</label>
        <input type="text" name="machine_id" value="{{ cfg['machine-id'] if 'machine-id' in cfg else '' }}">
        <label>API Host:</label>
        <input type="text" name="api_host" value="{{ cfg['api-server'] if 'api-server' in cfg else '' }}">
        <button type="submit">Save Device Info</button>
    </form>
    <form method="post" action="{{ url_for('restart_app') }}">
        <button style="width: 100%; background-color: red;" class="danger" type="submit">RESTART APPLICATION</button>
    </form>
</div>

<script>
function refreshSSID(){
    fetch('/scan_ssid')
    .then(res => res.json())
    .then(data => {
        let select = document.getElementById('ssid-list');
        select.innerHTML = '';
        data.forEach(ssid => {
            let opt = document.createElement('option');
            opt.value = ssid;
            opt.innerText = ssid;
            select.appendChild(opt);
        });
    });
}
</script>
</body>
</html>
